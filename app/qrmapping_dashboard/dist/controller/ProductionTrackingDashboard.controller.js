sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","com/ingenx/qrmappingdashboard/utils/HelperFunction"],(e,t,o,a,n,i)=>{"use strict";return e.extend("com.ingenx.qrmappingdashboard.controller.ProductionTrackingDashboard",{onInit(){},_onDashboardBatchValueHelp:function(){i._openValueHelpDialog(this,"_dashboardBatchIdDataFragment","com.ingenx.qrmappingdashboard.fragments.batchCodeValueHelp")},_onDashboardOCValueHelp:function(){i._openValueHelpDialog(this,"_dashboardOCCodeFragment","com.ingenx.qrmappingdashboard.fragments.ocCodeValueHelp")},onOCValueConfirmItem:function(e){i._valueHelpSelectedValue(e,this,"productionDashboard_ocID")},onBatchValueHelpSearch:function(e){i._valueHelpLiveSearch(e,"BatchNo")},onOCValueHelpSearch:function(e){i._valueHelpLiveSearch(e,"orderConfirmationId")},onBatchValueConfirmItem:async function(e){let t=this.byId("productionDashboard_ocID");let o=i._valueHelpSelectedValue(e,this,"productionDashboard_batchId");let a=await i._getSingleEntityDataWithParam(this,"getBatchOCValueHelp","BatchID",o);if(t){t.setValue("")}let n=new sap.ui.model.json.JSONModel(a);this.getView().setModel(n,"batchDataModel");console.log("model data",this.getView().getModel("batchDataModel").getData());const r=e.getSource().getBinding("items");r.filter([])},handleChange:async function(e){const t=e.getParameter("value");let o=await i._getSingleEntityDataWithParam(this,"getBatchOCValueHelp","ManufactureDt",t);let a=new sap.ui.model.json.JSONModel(o);this.getView().setModel(a,"batchDataModel");console.log("model data",this.getView().getModel("batchDataModel").getData())},_onGoButtonPress:async function(){let e=this.byId("productionDashboard_ocID").getValue();let t=this.byId("DP1");let o=t.getDateValue();let a=this.byId("productionDashboard_batchId").getValue();let r=this.byId("dashboard_shapeLayout");let s=this.byId("dashboard_ContainerDetailsLayout");s?s.setVisible(false):s.setVisible(true);if(e&&(a||o)){let t=encodeURIComponent(e);let o=await i._getSingleEntityDataWithParam(this,"getProductionTrackingDashboardData","OCID",t);console.log("coming data",o);let a=new n(o);this.getView().setModel(a,"orderModel");r?r.setVisible(true):console.warn("Layout not Found")}else{sap.m.MessageToast.show("Please Enter OC and either Batch or Manufacturing Date")}},onSearchOCItem:function(e){i.performTableSearchMethod(this,e,"dashboardOCproduct_ProductTable",["ICID","BatchID"])},onSearchBoxItem:function(e){i.performTableSearchMethod(this,e,"detailsFragemnt_boxTable",["SerialNo","BatchID"])},countFormatter:function(e){return e?e.length:" "},onImageClick:function(e){const t=this.getView();const o=e.getSource();const a=o.getBindingContext("orderModel");if(!a){return sap.m.MessageToast.show("No data found for this image.")}const n=a.getObject();if(n){n.ICs?.forEach(e=>{Object.assign(e,{ManufactureDt:n.ManufactureDt||"",ExpiryDt:n.ExpiryDt||"",ProductionOrder:n.ProductionOrder||"",BatchID:n.BatchID||"",Material:n.Material})});const e=new sap.ui.model.json.JSONModel(n);t.setModel(e,"fragmentModel");const o=t.byId("dashboard_ContainerDetailsLayout");if(o){o.setVisible(true)}}console.log("Clicked Image Data:",n)},onDashboardPrintQR:function(){var e=this.byId("dashboardDetailsqrImage");var t=e.getSrc();if(t){var o=new Image;o.onload=function(){console.log("Image loaded successfully. Proceeding to print...");var e=window.open("","_blank");e.document.write("<html><head><title>Print QR Code</title></head><body>");e.document.write('<img src="'+t+'" style="width:200px;height:200px;"/>');e.document.write("</body></html>");e.document.close();setTimeout(()=>{e.print();e.close()},500)};o.onerror=function(){console.error("Failed to load the QR code image from URL:",t);sap.m.MessageToast.show("Failed to load the QR code image.")};o.src=t}else{console.warn("QR Code source is empty or undefined.");sap.m.MessageToast.show("QR Code is not available for printing.")}},_onOCQrCodeLink:function(e){var t=this.getView().getModel("fragmentModel");var o=t.getData();let a=o.OCQRCodeURL;let n=this.byId("dashboarDeatislDetailQrDialog");let i=this.byId("dashboardDetailsqrImage");i.setSrc(a);n.open()},onDashboardBoxQrCode:function(e){this.openQrDialogBox(e,"boxModelData","BoxQRCodeURL")},onDashboardICQrCode:function(e){this.openQrDialogBox(e,"fragmentModel","ICQRCodeURL")},openQrDialogBox:function(e,t,o){let a=e.getSource();let n=a.getBindingContext(t);let i=n.getObject();let r=i[o];let s=this.byId("dashboarDeatislDetailQrDialog");let l=this.byId("dashboardDetailsqrImage");l.setSrc(r);s.open()},onCloseQRDialog:function(){this.byId("dashboarDeatislDetailQrDialog").close()},onIcRowSelect:function(e){const t=this.getView();const o=e.getSource().getBindingContext("fragmentModel");if(!o){return sap.m.MessageToast.show("No Data Found")}const a=o.getObject();const n=a?.Boxes||[];if(!Array.isArray(n)||n.length===0){return sap.m.MessageToast.show("No Data Found")}n.forEach(e=>{Object.assign(e,{ManufactureDt:a.ManufactureDt||"",ExpiryDt:a.ExpiryDt||"",ProductionOrder:a.ProductionOrder||"",BatchID:a.BatchID||"",Material:a.Material})});const i=new sap.ui.model.json.JSONModel({boxes:n});t.setModel(i,"boxModelData");console.log("my order Data:",i.getData());const r=t.byId("idIconTabBar");if(r){const e=t.byId("DialogBoxDetails");if(e){e.setEnabled(true)}r.setSelectedKey("boxKey")}else{console.error("IconTabBar not found.")}}})});
//# sourceMappingURL=ProductionTrackingDashboard.controller.js.map