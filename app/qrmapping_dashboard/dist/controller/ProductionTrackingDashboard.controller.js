sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","com/ingenx/qrmappingdashboard/utils/HelperFunction"],(e,t,a,o,i,s)=>{"use strict";return e.extend("com.ingenx.qrmappingdashboard.controller.ProductionTrackingDashboard",{onInit(){},_onDashboardBatchValueHelp:function(){let e=this.byId("productionDashboard_ocID");if(e){e.setValue("")}let t=this.byId("dashboard_shapeLayout");let a=this.byId("dashboard_ContainerDetailsLayout");if(t)t.setVisible(false);if(a)a.setVisible(false);s._openValueHelpDialog(this,"_dashboardBatchIdDataFragment","com.ingenx.qrmappingdashboard.fragments.batchCodeValueHelp")},_onDashboardOCValueHelp:function(){s._openValueHelpDialog(this,"_dashboardOCCodeFragment","com.ingenx.qrmappingdashboard.fragments.ocCodeValueHelp")},onOCValueConfirmItem:function(e){s._valueHelpSelectedValue(e,this,"productionDashboard_ocID")},onBatchValueHelpSearch:function(e){s._valueHelpLiveSearch(e,"BatchNo","batchValueHelpValueHelp1",this)},onOCValueHelpSearch:function(e){s._valueHelpLiveSearch(e,"OCID","ocCodeValueHelp",this)},onBatchValueConfirmItem:async function(e){this.selectedBatchValue=s._valueHelpSelectedValue(e,this,"productionDashboard_batchId");let t=await s._getSingleEntityDataWithParam(this,"getBatchOCValueHelp","BatchID",this.selectedBatchValue);let a=new sap.ui.model.json.JSONModel(t);this.getView().setModel(a,"batchDataModel");console.log("model data",this.getView().getModel("batchDataModel").getData());const o=e.getSource().getBinding("items");o.filter([])},handleChange:async function(e){this.selectedDate=e.getParameter("value")},_onGoButtonPress:async function(){let e=[];let t=[];if(!this._busyDialog){this._busyDialog=new sap.m.BusyDialog({title:"Fetching OCID"})}this._busyDialog.open();try{let a=this.byId("productionDashboard_ocID").getValue().trim();if(this.selectedBatchValue){e=await s._getSingleEntityDataWithParam(this,"getBatchOCValueHelp","BatchID",this.selectedBatchValue)}else if(this.selectedDate){e=await s._getSingleEntityDataWithParam(this,"getBatchOCValueHelp","ManufactureDt",this.selectedDate)}else{sap.m.MessageToast.show("Please select either a Batch or a Date before proceeding.");return}if(!e||e.length===0){sap.m.MessageToast.show("No OCID found");return}if(a){e=e.filter(e=>e.OCID===a)}t=e.map(e=>e.OCID).filter(e=>e);if(t.length===0){sap.m.MessageToast.show("No OCID found for the selected Batch or Manufacture Date.");return}let o=[];for(let e of t){let t=encodeURIComponent(e);let a=await s._getSingleEntityDataWithParam(this,"getProductionTrackingDashboardData","OCID",t);o.push(...a)}if(o.length===0){sap.m.MessageToast.show("No production tracking data found for the selected OCIDs.");return}let n=new i(o);this.getView().setModel(n,"orderModel");console.log("Final Order Model:",o);let r=this.byId("dashboard_shapeLayout");let l=this.byId("dashboard_ContainerDetailsLayout");if(l){l.setVisible(false)}if(r){r.setVisible(true)}else{console.warn("Shape Layout not found")}}catch(e){console.error("Error fetching data:",e);sap.m.MessageToast.show("An error occurred while fetching data.")}finally{this._busyDialog.close()}},onSearchOCItem:function(e){s.performTableSearchMethod(this,e,"dashboardOCproduct_ProductTable",["ICID","BatchID"])},onSearchBoxItem:function(e){s.performTableSearchMethod(this,e,"detailsFragemnt_boxTable",["SerialNo","BatchID"])},countFormatter:function(e){return e?e.length:" "},onImageClick:function(e){const t=this.getView();const a=e.getSource();const o=a.getBindingContext("orderModel");if(!o){return sap.m.MessageToast.show("No data found for this image.")}const i=t.byId("idIconTabBar");if(i){const e=t.byId("tankDialogDetailsTab");if(e){e.setEnabled(true)}i.setSelectedKey("initial")}else{console.error("IconTabBar not found.")}const s=o.getObject();if(s){s.ICs?.forEach(e=>{Object.assign(e,{ManufactureDt:s.ManufactureDt||"",ExpiryDt:s.ExpiryDt||"",ProductionOrder:s.ProductionOrder||"",BatchID:s.BatchID||"",Material:s.Material})});const e=new sap.ui.model.json.JSONModel(s);t.setModel(e,"fragmentModel");const a=t.byId("dashboard_ContainerDetailsLayout");if(a){a.setVisible(true)}}console.log("Clicked Image Data:",s)},onDashboardPrintQR:function(){var e=this.byId("dashboardDetailsqrImage");var t=e.getSrc();if(t){var a=new Image;a.onload=function(){console.log("Image loaded successfully. Proceeding to print...");var e=window.open("","_blank");e.document.write("<html><head><title>Print QR Code</title></head><body>");e.document.write('<img src="'+t+'" style="width:200px;height:200px;"/>');e.document.write("</body></html>");e.document.close();setTimeout(()=>{e.print();e.close()},500)};a.onerror=function(){console.error("Failed to load the QR code image from URL:",t);sap.m.MessageToast.show("Failed to load the QR code image.")};a.src=t}else{console.warn("QR Code source is empty or undefined.");sap.m.MessageToast.show("QR Code is not available for printing.")}},_onOCQrCodeLink:function(e){var t=this.getView().getModel("fragmentModel");var a=t.getData();let o=a.OCQRCodeURL;let i=this.byId("dashboarDeatislDetailQrDialog");let s=this.byId("dashboardDetailsqrImage");s.setSrc(o);i.open()},onDashboardBoxQrCode:function(e){this.openQrDialogBox(e,"boxModelData","BoxQRCodeURL")},onDashboardICQrCode:function(e){this.openQrDialogBox(e,"fragmentModel","ICQRCodeURL")},openQrDialogBox:function(e,t,a){let o=e.getSource();let i=o.getBindingContext(t);let s=i.getObject();let n=s[a];let r=this.byId("dashboarDeatislDetailQrDialog");let l=this.byId("dashboardDetailsqrImage");l.setSrc(n);r.open()},onCloseQRDialog:function(){this.byId("dashboarDeatislDetailQrDialog").close()},onIcRowSelect:function(e){const t=this.getView();const a=e.getSource().getBindingContext("fragmentModel");if(!a){return sap.m.MessageToast.show("No Data Found")}const o=a.getObject();const i=o?.Boxes||[];if(!Array.isArray(i)||i.length===0){return sap.m.MessageToast.show("No Data Found")}i.forEach(e=>{Object.assign(e,{ManufactureDt:o.ManufactureDt||"",ExpiryDt:o.ExpiryDt||"",ProductionOrder:o.ProductionOrder||"",BatchID:o.BatchID||"",Material:o.Material})});const s=new sap.ui.model.json.JSONModel({boxes:i});t.setModel(s,"boxModelData");console.log("my order Data:",s.getData());const n=t.byId("idIconTabBar");if(n){const e=t.byId("DialogBoxDetails");if(e){e.setEnabled(true)}n.setSelectedKey("boxKey")}else{console.error("IconTabBar not found.")}}})});
//# sourceMappingURL=ProductionTrackingDashboard.controller.js.map